window.publiiStaticSearchInitCallback=function(t){window.publiiStaticSearch.indexLoaded||(window.publiiStaticSearch.cachedItems=t,window.publiiStaticSearch.initIndex())},window.publiiStaticSearch={cachedItems:null,searchIndex:null,indexLoaded:!1,htmlLoaded:!1,UI:{customTrigger:null,smallSearchInput:null,smallSearchForm:null,input:null,overlay:null,popupContent:null,emptyState:null,tooShortPhraseState:null,noResultsState:null,listWithResults:null,listWithResultsContent:null},config:{minCharCount:window.publiiStaticSearchConfig.minCharCount,maxResultsCount:window.publiiStaticSearchConfig.maxResultsCount,engineSettings:{tokenize:window.publiiStaticSearchConfig.engineSettings.tokenize,charset:window.publiiStaticSearchConfig.engineSettings.charset,language:window.publiiStaticSearchConfig.engineSettings.language,cache:window.publiiStaticSearchConfig.engineSettings.cache,suggest:window.publiiStaticSearchConfig.engineSettings.suggest},indexSettings:{resultsDescription:window.publiiStaticSearchConfig.indexSettings.resultsDescription,indexPostTitles:window.publiiStaticSearchConfig.indexSettings.indexPostTitles,indexPostExcerpts:window.publiiStaticSearchConfig.indexSettings.indexPostExcerpts,indexPostHeadings:window.publiiStaticSearchConfig.indexSettings.indexPostHeadings,indexPostAuthors:window.publiiStaticSearchConfig.indexSettings.indexPostAuthors,indexPostMetaDescription:window.publiiStaticSearchConfig.indexSettings.indexPostMetaDescription,indexPageTitles:window.publiiStaticSearchConfig.indexSettings.indexPageTitles,indexPageExcerpts:window.publiiStaticSearchConfig.indexSettings.indexPageExcerpts,indexPageHeadings:window.publiiStaticSearchConfig.indexSettings.indexPageHeadings,indexPageMetaDescription:window.publiiStaticSearchConfig.indexSettings.indexPageMetaDescription,indexTagNames:window.publiiStaticSearchConfig.indexSettings.indexTagNames,indexTagDescription:window.publiiStaticSearchConfig.indexSettings.indexTagDescription,indexTagMetaDescription:window.publiiStaticSearchConfig.indexSettings.indexTagMetaDescription,indexPostConfig:window.publiiStaticSearchConfig.indexSettings.indexPostConfig,indexPageConfig:window.publiiStaticSearchConfig.indexSettings.indexPageConfig}},templates:{searchPopup:`
        <div class="pss-results__wrapper">
            <div class="pss-results__searchbar">
                <input 
                    class="pss-results__searchbar__input" 
                    type="search"
                    placeholder="${window.publiiStaticSearchConfig.translations.inputPlaceholder}" />
                    <svg 
                       class="pss-results__searchbar__icon" 
                       width="24" 
                       height="24" 
                       viewBox="0 0 24 24">
                          <path d="M21.71,20.29,18,16.61A9,9,0,1,0,16.61,18l3.68,3.68a1,1,0,0,0,1.42,0A1,1,0,0,0,21.71,20.29ZM4,11a7,7,0,1,1,12,4.93h0s0,0,0,0A7,7,0,0,1,4,11Z"/>
                    </svg>
                    <button 
                       class="pss-results__searchbar__btn"
                       type="button">
                       ${window.publiiStaticSearchConfig.translations.buttonClose}
                    </button>
            </div>

            <div class="pss-results__msg pss-results__msg--empty">
                ${window.publiiStaticSearchConfig.translations.searchEmptyState}
            </div>

            <div 
                class="pss-results__msg pss-results__msg--too-short" 
                hidden>
                ${window.publiiStaticSearchConfig.translations.tooShortPhraseState}
            </div>

            <div 
                class="pss-results__msg pss-results__msg--no-results" 
                hidden>
                ${window.publiiStaticSearchConfig.translations.noResults}
            </div>

            <ol class="pss-results__list" hidden></ol>
            
        </div>
        `,searchItem:`
            <li class="pss-results__list__item">
                <a href="{PSS_URL}" class="pss-results__list__link">
                    {PSS_ICON}
                    <strong class="pss-results__list__title">
                        {PSS_TITLE}
                    </strong>
                    <small class="pss-results__list__text">
                        {PSS_TEXT}
                    </small>
                </a>
            </li>
        `,searchItemWithoutText:`
            <li class="pss-results__list__item">
                <a href="{PSS_URL}" class="pss-results__list__link">
                    {PSS_ICON}
                    
                    <strong class="pss-results__list__title">
                        {PSS_TITLE}
                    </strong>
                </a>
            </li>
        `,postIcon:'<svg width="20" height="20" viewBox="0 0 24 24"><path d="M20.92,7.62a.93.93,0,0,0-.21-.33l-6-6a1,1,0,0,0-.32-.21A1.09,1.09,0,0,0,14,1H6A3,3,0,0,0,3,4V20a3,3,0,0,0,3,3H18a3,3,0,0,0,3-3V8A1,1,0,0,0,20.92,7.62ZM15,4.41,17.59,7H15ZM18,21H6a1,1,0,0,1-1-1V4A1,1,0,0,1,6,3h7V8a1,1,0,0,0,1,1h5V20A1,1,0,0,1,18,21Zm-1-8a1,1,0,0,1-1,1H8a1,1,0,0,1,0-2h8A1,1,0,0,1,17,13Zm0,4a1,1,0,0,1-1,1H8a1,1,0,0,1,0-2h8A1,1,0,0,1,17,17ZM7,9A1,1,0,0,1,8,8h2a1,1,0,0,1,0,2H8A1,1,0,0,1,7,9Z"/></svg>',pageIcon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.4333 6.35004C17.3952 6.247 17.3355 6.15326 17.2583 6.07504L12.2583 1.07504C12.1815 1.00008 12.091 0.94066 11.9917 0.900041C11.8883 0.858055 11.7782 0.835456 11.6667 0.833374H8.33333H5C4.33696 0.833374 3.70107 1.09677 3.23223 1.56561C2.76339 2.03445 2.5 2.67033 2.5 3.33337V16.6667C2.5 17.3297 2.76339 17.9656 3.23223 18.4345C3.70107 18.9033 4.33696 19.1667 5 19.1667H15C15.663 19.1667 16.2989 18.9033 16.7678 18.4345C17.2366 17.9656 17.5 17.3297 17.5 16.6667V6.66671C17.4987 6.55781 17.476 6.45023 17.4333 6.35004ZM12.5 3.67504L14.6583 5.83337H12.5V3.67504ZM15 17.5H5C4.77899 17.5 4.56702 17.4122 4.41074 17.256C4.25446 17.0997 4.16667 16.8877 4.16667 16.6667V3.33337C4.16667 3.11236 4.25446 2.9004 4.41074 2.74412C4.56702 2.58784 4.77899 2.50004 5 2.50004H10.8333V6.66671C10.8333 6.88772 10.9211 7.09968 11.0774 7.25596C11.2337 7.41224 11.4457 7.50004 11.6667 7.50004H15.8333V16.6667C15.8333 16.8877 15.7455 17.0997 15.5893 17.256C15.433 17.4122 15.221 17.5 15 17.5Z"/></svg>',tagIcon:'<svg width="20" height="20" viewBox="0 0 24 24"> <path d="M20,14H15.78l.45-4H20a1,1,0,0,0,0-2H16.45L17,3.11A1,1,0,0,0,16.11,2a1,1,0,0,0-1.1.88L14.44,8h-4L11,3.11a1,1,0,0,0-2-.22L8.44,8H4a1,1,0,0,0,0,2H8.22l-.45,4H4a1,1,0,0,0,0,2H7.55L7,20.89A1,1,0,0,0,7.89,22H8a1,1,0,0,0,1-.89L9.56,16h4L13,20.89a1,1,0,0,0,.88,1.1H14a1,1,0,0,0,1-.89L15.56,16H20a1,1,0,0,0,0-2ZM9.78,14l.45-4h4l-.45,4Z"/></svg>'},init(){if(this.UI.smallSearchForm=document.querySelector("form.search__form"),window.publiiStaticSearchConfig.customTriggerSelector&&(this.UI.customTrigger=document.querySelectorAll(window.publiiStaticSearchConfig.customTriggerSelector)),this.UI.smallSearchForm&&(this.UI.smallSearchInput=this.UI.smallSearchForm.querySelector(".search__input"),window.publiiStaticSearchConfig.showPopupOnInputClick?(this.UI.smallSearchForm.addEventListener("submit",t=>{t.preventDefault()},!1),this.UI.smallSearchInput.addEventListener("click",t=>{this.showPopup("")},!1)):this.UI.smallSearchForm.addEventListener("submit",t=>{t.preventDefault(),this.showPopup(this.UI.smallSearchInput.value)},!1)),this.UI.customTrigger)for(let t=0;t<this.UI.customTrigger.length;t++)this.UI.customTrigger[t].addEventListener("click",t=>{t.preventDefault(),this.showPopup("")},!1)},showPopup(t){this.htmlLoaded?(this.UI.overlay.classList.remove("is-hidden"),this.UI.input.value=t,this.UI.input.focus(),this.triggerSearchEvent()):(this.htmlLoaded=!0,this.appendHtmlStructure(),setTimeout(()=>{this.initPopupEvents(t),this.indexLoaded||this.loadIndex()},0))},loadIndex(){let t=1e5*parseInt(Date.now()/1e5,10),e=window.publiiStaticSearchConfig.baseURL+"/media/plugins/staticSearch/index.js?v="+t,i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",e),document.body.appendChild(i)},initIndex(){let t={charset:this.config.engineSettings.charset,language:this.config.engineSettings.language,preset:"match",tokenize:this.config.engineSettings.tokenize,cache:this.config.engineSettings.cache,suggest:this.config.engineSettings.suggest};this.searchIndex=new FlexSearch.Index(t);for(let e=0;e<this.cachedItems.length;e++){let i=this.cachedItems[e],s=[];0===i.id.indexOf("post-")?(this.config.indexSettings.indexPostTitles&&s.push(i.title),this.config.indexSettings.indexPostExcerpts&&s.push(i.excerpt),this.config.indexSettings.indexPostHeadings&&s.push(i.headings),this.config.indexSettings.indexPostAuthors&&s.push(i.author),this.config.indexSettings.indexPostMetaDescription&&s.push(i.metaDescription),this.config.indexSettings.indexPostConfig&&s.push(i.config)):0===i.id.indexOf("page-")?(this.config.indexSettings.indexPageTitles&&s.push(i.title),this.config.indexSettings.indexPageExcerpts&&s.push(i.excerpt),this.config.indexSettings.indexPageHeadings&&s.push(i.headings),this.config.indexSettings.indexPageMetaDescription&&s.push(i.metaDescription),this.config.indexSettings.indexPageConfig&&s.push(i.config)):0===i.id.indexOf("tag-")&&(this.config.indexSettings.indexTagNames&&s.push(i.title),this.config.indexSettings.indexTagDescription&&s.push(i.excerpt),this.config.indexSettings.indexTagMetaDescription&&s.push(i.metaDescription)),this.searchIndex.add(i.id,s.join(" "))}this.indexLoaded=!0,this.UI.overlay.classList.remove("is-loading"),setTimeout(()=>{this.triggerSearchEvent()},0)},appendHtmlStructure(){let t=document.createElement("div");t.setAttribute("class","pss-results is-hidden is-loading"),t.innerHTML=this.templates.searchPopup,document.body.appendChild(t)},initPopupEvents(t){this.UI.input=document.querySelector(".pss-results__searchbar__input"),this.UI.overlay=document.querySelector(".pss-results"),this.UI.popupContent=document.querySelector(".pss-results__wrapper"),this.UI.emptyState=document.querySelector(".pss-results__msg--empty"),this.UI.noResultsState=document.querySelector(".pss-results__msg--no-results"),this.UI.tooShortPhraseState=document.querySelector(".pss-results__msg--too-short"),this.UI.listWithResultsContent=document.querySelector(".pss-results__list"),this.UI.popupCloseBtn=document.querySelector(".pss-results__searchbar__btn"),this.UI.input.addEventListener("input",()=>{this.triggerSearchEvent()},!1),this.UI.overlay.addEventListener("click",()=>{this.UI.input.value="",this.showEmptyState(),this.UI.overlay.classList.add("is-hidden")},!1),this.UI.popupCloseBtn.addEventListener("click",()=>{this.UI.input.value="",this.showEmptyState(),this.UI.overlay.classList.add("is-hidden")},!1),this.UI.popupContent.addEventListener("click",t=>{t.stopPropagation()},!1);let e=null;this.UI.listWithResultsContent.addEventListener("scroll",()=>{clearTimeout(e),this.UI.listWithResultsContent.classList.contains("is-scrolled")||this.UI.listWithResultsContent.classList.add("is-scrolled"),e=setTimeout(()=>{this.UI.listWithResultsContent.classList.remove("is-scrolled")},350)},!1),setTimeout(()=>{this.UI.overlay.classList.remove("is-hidden"),this.UI.input.value=t,this.UI.input.focus(),this.triggerSearchEvent()},0),document.addEventListener("keydown",t=>{"Escape"!==t.key&&"Esc"!==t.key||this.UI.overlay.classList.contains("is-hidden")||(this.UI.input.value="",this.showEmptyState(),this.UI.overlay.classList.add("is-hidden"))},!1)},search(t){if(null===this.searchIndex)return!1;let e=this.searchIndex.search(t,this.config.maxResultsCount);return this.cachedItems.filter(t=>e.includes(t.id))},showEmptyState(){this.UI.emptyState.removeAttribute("hidden"),this.UI.tooShortPhraseState.setAttribute("hidden",!0),this.UI.noResultsState.setAttribute("hidden",!0),this.UI.listWithResultsContent.setAttribute("hidden",!0)},showTooShortState(){this.UI.emptyState.setAttribute("hidden",!0),this.UI.tooShortPhraseState.removeAttribute("hidden"),this.UI.noResultsState.setAttribute("hidden",!0),this.UI.listWithResultsContent.setAttribute("hidden",!0)},showNoResults(){this.UI.emptyState.setAttribute("hidden",!0),this.UI.tooShortPhraseState.setAttribute("hidden",!0),this.UI.noResultsState.removeAttribute("hidden"),this.UI.listWithResultsContent.setAttribute("hidden",!0)},showResults(){this.UI.emptyState.setAttribute("hidden",!0),this.UI.tooShortPhraseState.setAttribute("hidden",!0),this.UI.noResultsState.setAttribute("hidden",!0),this.UI.listWithResultsContent.removeAttribute("hidden")},renderResults(t){let e="";for(let i=0;i<t.length;i++){let s="",n=window.publiiStaticSearch.templates.postIcon,a="searchItem",h=t[i].url,l=t[i].title;0===t[i].id.indexOf("tag-")&&(n=window.publiiStaticSearch.templates.tagIcon),0===t[i].id.indexOf("page-")&&(n=window.publiiStaticSearch.templates.pageIcon),"excerpt"===this.config.indexSettings.resultsDescription?s=t[i].excerpt:"metadescription"===this.config.indexSettings.resultsDescription&&(s=t[i].metaDescription),""===s&&(a="searchItemWithoutText"),h.indexOf("#PUBLII_RELATIVE_URL_BASE#")>-1&&(h=h.replace("#PUBLII_RELATIVE_URL_BASE#",""));e+=this.templates[a].replace(/\{PSS_ICON\}/gmi,n).replace(/\{PSS_URL\}/gmi,h).replace(/\{PSS_TITLE\}/gmi,l).replace(/\{PSS_TEXT\}/gmi,s)}this.UI.listWithResultsContent.innerHTML=e},triggerSearchEvent(){if(this.indexLoaded){if(this.UI.input.value.trim().length>=this.config.minCharCount){let t=this.search(this.UI.input.value.trim());!1!==t&&t.length?(this.showResults(),this.renderResults(t)):this.showNoResults()}else this.UI.input.value.trim().length>0?this.showTooShortState():this.showEmptyState()}}},window.publiiStaticSearch.init();